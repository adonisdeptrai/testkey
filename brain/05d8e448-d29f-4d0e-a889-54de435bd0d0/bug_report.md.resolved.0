# Bug Report & Testing Checklist

Comprehensive check sau Supabase Auth migration.

---

## âœ… PASSING CHECKS

### Build Status
- âœ… **Frontend build successful** (no TypeScript errors)
- âœ… **No compilation errors**
- âœ… **Vercel Analytics integrated**
- âœ… **SPA routing configured** (vercel.json)
- âœ… **Dev server running** (port 8080)

### Code Quality
- âœ… **No critical linter errors detected**
- âœ… **Error handling present** (35 console.error locations tracked)
- âœ… **Type safety maintained** (User type fixed)

---

## âš ï¸ KNOWN ISSUES

### 1. **Supabase Auth Migration INCOMPLETE**

**Status:** ğŸ”´ **CRITICAL - Backend still using JWT**

**Problem:**
- Frontend Ä‘Ã£ migrate sang Supabase Auth âœ“
- **Backend CHÆ¯A migrate** - váº«n expect custom JWT tokens
- Authentication sáº½ fail vÃ¬ mismatch

**Affected Routes:**
- `POST /api/auth/login` - Still generates JWT
- `POST /api/auth/register` - Still generates JWT
- `GET /api/auth/verify-email` - Still uses JWT
- Auth middleware - Still verifies JWT

**Impact:**
- âŒ Email/password login **KHÃ”NG hoáº¡t Ä‘á»™ng**
- âŒ Registration **KHÃ”NG hoáº¡t Ä‘á»™ng**
- âœ… Google OAuth **CÃ“ THá»‚ work** (if Supabase enabled)

**Fix Required:**
See [implementation_plan.md](file:///C:/Users/Adonis/.gemini/antigravity/brain/05d8e448-d29f-4d0e-a889-54de435bd0d0/implementation_plan.md) Phase 1

---

### 2. **Google OAuth Setup Required**

**Status:** ğŸŸ¡ **ACTION NEEDED**

**Checklist:**
- [x] Frontend code ready
- [x] Supabase client configured
- [ ] Google Cloud Console OAuth credentials created
- [ ] Google provider enabled in Supabase Dashboard
- [ ] OAuth consent screen branded with "R4bbit"

**Test:** Click "Sign in with Google" â†’ Should show Google login, not error

**Guide:** [oauth_branding_guide.md](file:///C:/Users/Adonis/.gemini/antigravity/brain/05d8e448-d29f-4d0e-a889-54de435bd0d0/oauth_branding_guide.md)

---

### 3. **User Role Management**

**Status:** ğŸŸ¢ **READY TO USE**

**Admin script created:**
```bash
node server/scripts/make-admin.js <email>
```

**Test:**
1. Register new user
2. Run script to promote to admin
3. Login â†’ Access `/admin` dashboard

---

## ğŸ§ª MANUAL TEST CHECKLIST

### Pre-Test Setup

```bash
# 1. Start dev server
npm run dev

# 2. Start backend
cd server
npm run dev
```

**Access:** http://localhost:8080

---

### Test Cases

#### Test 1: Homepage Load
- [ ] Navigate to http://localhost:8080
- [ ] Page loads without errors
- [ ] No console errors (F12)
- [ ] "Sign in with Google" button visible

**Expected:** Landing page renders correctly

---

#### Test 2: Google OAuth (If Configured)
- [ ] Click "Sign in with Google"
- [ ] Redirects to Google login
- [ ] After authorize â†’ Redirect to /auth/callback
- [ ] Redirect to /shop

**Expected:** Successful OAuth flow

**If fails:**
- Check error message
- Verify Supabase Google provider enabled
- Check redirect URLs configured

---

#### Test 3: Email/Password Registration
- [ ] Click "Sign Up" tab
- [ ] Enter username, email, password
- [ ] Submit form

**Expected:**
- âŒ **WILL FAIL** (backend not migrated yet)
- Error: JWT token mismatch

**After backend migration:**
- âœ… Success message
- âœ… Email verification sent
- âœ… Check inbox for Supabase email

---

#### Test 4: Email/Password Login
- [ ] Enter email + password
- [ ] Click "Login"

**Expected:**
- âŒ **WILL FAIL** (backend not migrated yet)

**After backend migration:**
- âœ… Successful login
- âœ… Redirect to /shop
- âœ… User data loaded

---

#### Test 5: Admin Access
- [ ] Login as admin user
- [ ] Navigate to /admin

**Expected:**
- âœ… Admin dashboard loads
- âœ… Can view products, orders, settings

**If fails:**
- Check user role in Supabase users table
- Run make-admin script

---

#### Test 6: Session Persistence
- [ ] Login successfully
- [ ] Refresh page (F5)
- [ ] Close browser, reopen

**Expected:**
- âœ… Still logged in after refresh
- âœ… User data persists

---

#### Test 7: Logout
- [ ] Click logout
- [ ] Try accessing /admin

**Expected:**
- âœ… Session cleared
- âœ… Redirect to login
- âœ… Cannot access protected routes

---

## ğŸ”§ FIXES NEEDED (Priority Order)

### Priority 1: Backend Migration (BLOCKING)

**Task:** Migrate backend auth routes to Supabase Auth

**Files to modify:**
- [ ] [server/routes/auth.js](file:///c:/Users/Adonis/Downloads/App/server/routes/auth.js) - Login endpoint
- [ ] [server/routes/auth.js](file:///c:/Users/Adonis/Downloads/App/server/routes/auth.js) - Register endpoint
- [ ] [server/middleware/auth.js](file:///c:/Users/Adonis/Downloads/App/server/middleware/auth.js) - Token verification
- [ ] [server/routes/oauth.js](file:///c:/Users/Adonis/Downloads/App/server/routes/oauth.js) - Simplify or remove

**Estimated time:** 2-3 hours

**Instructions:** Follow [implementation_plan.md](file:///C:/Users/Adonis/.gemini/antigravity/brain/05d8e448-d29f-4d0e-a889-54de435bd0d0/implementation_plan.md) Phase 1

---

### Priority 2: Google OAuth Setup

**Task:** Enable Google OAuth in Supabase + Google Cloud Console

**Steps:**
1. Create OAuth credentials in Google Cloud Console
2. Enable Google provider in Supabase Dashboard
3. Configure authorized redirect URLs
4. Brand OAuth consent screen

**Estimated time:** 30 minutes

**Guide:** [oauth_branding_guide.md](file:///C:/Users/Adonis/.gemini/antigravity/brain/05d8e448-d29f-4d0e-a889-54de435bd0d0/oauth_branding_guide.md)

---

### Priority 3: Database RLS Policies

**Task:** Setup Row Level Security

**Tables needing RLS:**
- `users` - Users can only read/update their own data
- `orders` - Users can only view their own orders
- `product_keys` - Restricted to admin
- `settings` - Admin only

**Query template:**
```sql
ALTER TABLE users ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can view own data"
ON users FOR SELECT
USING (auth.uid() = id);

CREATE POLICY "Users can update own data"  
ON users FOR UPDATE
USING (auth.uid() = id);
```

---

## ğŸ“Š VERIFICATION METRICS

**After fixes, verify:**

| Metric | Target | Status |
|--------|--------|--------|
| Frontend build | No errors | âœ… PASS |
| Backend build | No errors | â³ TODO |
| Email/Password auth | Working | âŒ BLOCKED |
| Google OAuth | Working | ğŸŸ¡ CONFIG NEEDED |
| Session persistence | Working | â³ TEST AFTER FIX |
| Admin access | Working | âœ… READY |
| RLS policies | Configured | âŒ NOT SET |

---

## ğŸš€ DEPLOYMENT STATUS

### localhost:8080 (Development)
- âœ… Frontend running
- âœ… Backend running
- âš ï¸ Auth partially broken (JWT mismatch)

### r4bbit-hub.vercel.app (Production)
- âœ… Deployed
- âœ… SPA routing working
- âœ… Analytics integrated
- âš ï¸ Auth issues same as localhost

---

## ğŸ“ NEXT STEPS

1. **IMMEDIATE:** Complete backend migration (Priority 1)
2. **THEN:** Setup Google OAuth (Priority 2)
3. **FINALLY:** Configure RLS policies (Priority 3)

**After ALL fixes:**
- Run full test suite
- Verify all auth flows
- Update [task.md](file:///C:/Users/Adonis/.gemini/antigravity/brain/05d8e448-d29f-4d0e-a889-54de435bd0d0/task.md) with completed items
- Update [walkthrough.md](file:///C:/Users/Adonis/.gemini/antigravity/brain/05d8e448-d29f-4d0e-a889-54de435bd0d0/walkthrough.md) with test results

---

## ğŸ” DEBUG COMMANDS

```bash
# Check Supabase connection
node -e "const {supabase} = require('./server/config/supabase'); supabase.from('users').select('count').then(console.log)"

# Check frontend env vars
npm run dev -- --debug

# View backend logs
tail -f server/logs/app.log

# SQL check user roles
# Run in Supabase SQL Editor:
SELECT username, email, role FROM users;
```

---

**âš ï¸ Browser testing currently unavailable** due to environment issue. Manual testing required in actual browser.
